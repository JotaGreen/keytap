<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Piano Sight Reading Rhythm Game</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Basic styles to prevent scrolling and hide elements initially */
        body {
            margin: 0;
            overflow: hidden; /* Prevents scrollbars */
            font-family: sans-serif; /* Basic default font */
            background-color: #f0f0f0; /* Light background for loading */
            overscroll-behavior: none; /* Prevents pull-to-refresh/bounce effects */
        }

        /* Hide all screen divs by default */
        .screen {
            display: none; /* Elements with this class are hidden */
            width: 100%;
            height: 100vh; /* Full viewport height */
            position: absolute; /* Allows screens to overlay if needed */
            top: 0;
            left: 0;
            box-sizing: border-box; /* Include padding and border in element's total width and height */
        }

        /* Style for the currently active screen */
        .screen.active {
            display: flex; /* Use flexbox for layout within screens (can be overridden) */
            flex-direction: column; /* Default layout direction */
        }

        /* Simple loading indicator */
        #loading-indicator {
            display: none; /* Hidden initially */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.2em;
            color: #333;
            /* Style moved to style.css for consistency */
        }
    </style>
</head>
<body>
    <div id="game-container">

        <div id="loading-screen" class="screen active">
            <h1>Piano Sight Reading Rhythm Game</h1>
            <p>Load your song files to begin.</p>

            <div>
                <label for="audio-file-input">Load Audio (MP3):</label>
                <input type="file" id="audio-file-input" accept=".mp3">
            </div>
            <div>
                <label for="json-file-input">Load Note Map (JSON):</label>
                <input type="file" id="json-file-input" accept=".json">
            </div>
            <div id="loading-status"></div> <div id="settings-area">
                <h2>Settings</h2>
                <div id="volume-control"></div>
                <div id="theme-toggle"></div>
                <div id="scroll-speed"></div>
                <div id="note-color-toggle"></div>
                <div id="no-death-mode"></div>
                <div id="wait-mode"></div>
                <div id="hit-window"></div>
                <div id="playback-rate"></div>
                <div id="note-names-toggle"></div>
                <div id="latency-calibration">
                    <button id="calibrate-latency-button">Calibrate Latency</button>
                    <span id="latency-value">Offset: 0ms</span>
                </div>
            </div>

            <button id="start-button" disabled>Load Files to Start</button>

            <button id="load-test-data-button">Load Test Data</button>

            <div id="loading-indicator">Loading...</div>
        </div>

        <div id="game-screen" class="screen">
            <div id="staff-area">
                </div>

            <div id="bottom-panel">
                <div id="info-display">
                    <div id="health-bar-container">
                        Health: <span id="health-value">50</span> / 75
                        <div id="health-bar-visual">
                             <div id="health-bar-fill"></div>
                        </div>
                    </div>
                    <div id="combo-display">Combo: <span id="combo-count">0</span></div>
                    <div id="score-display">Score: <span id="score-value">0</span></div>
                    <button id="pause-button">Pause</button>
                </div>

                <div id="keyboard-area">
                    </div>
            </div>
        </div>

        <div id="pause-overlay" class="screen">
            <h2>Paused</h2>
            <button id="resume-button">Resume</button>
            <div id="pause-volume-control">
                 </div>
            <button id="quit-button">Quit to Menu</button>
        </div>

        <div id="results-screen" class="screen">
            <h2>Results</h2>
            <div id="final-score">Score: <span></span></div>
            <div id="performance-stats">
                <p>Perfect: <span id="perfect-percent"></span>% (<span id="perfect-count"></span>)</p>
                <p>Good: <span id="good-percent"></span>% (<span id="good-count"></span>)</p>
                <p>Miss: <span id="miss-percent"></span>% (<span id="miss-count"></span>)</p>
                <p>Max Combo: <span id="max-combo"></span></p>
            </div>
            <div id="result-message"></div> <button id="return-to-menu-button">Return to Menu</button>
        </div>

    </div> <script>console.log("HTML: Attempting to load PixiJS...");</script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.4.2/pixi.min.js" referrerpolicy="no-referrer"></script>
    <script>
        if (typeof PIXI !== 'undefined') {
            console.log("HTML: PixiJS script tag processed. PIXI object IS defined.", PIXI);
        } else {
            console.error("HTML: PixiJS script tag processed. PIXI object IS NOT defined.");
        }
    </script>

    <script src="colorconversion.js" defer></script>

    <script src="game.js" defer></script>
    </body>
</html>

